<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quirofano</title>
    <link rel="stylesheet" href="./style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
  </head>
  <body>
    <!-- Navbar  -->
    <section class="bg-primary text-light p-1">
      <nav class="navbar navbar-expand-lg navbar-light bg-primary">
        <div class="container-fluid">
          <a class="navbar-brand" href="./index.html" alt="Brand Logo"></a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="./index.html"><h2>Quirofano</h2> </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="./index2.html"
                  ><h2>Lista de Espera</h2>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </section>
    <!-- campo nombre del paciente -->
    <section class="bg-light text-dark p-5 text-left">
      <div class="container">
        <div class="row text-center">
          <h2>Registro de Cirugia</h2>
        </div>
        <br>
        <form class="row g-3 was-validated" id="dataForm">
          <div class="col-md-3">
            <!-- Nombre Paciente -->
            <label for="PatientName"><b>Nombre del Paciente</b></label>
            <input type="text" class="form-control" name="PatientName" required/>
            <br>
            <!-- ESPERA -->
            <label for="ReasonForWaiting"><b>Razon de Espera</b></label>
            <select class="form-select" name="ReasonForWaiting" required aria-label="select example">
              <option value="">Seleccione razon de espera</option>
              <option value="Falta Donante">Falta Donante</option>
              <option value="Espera Aprobación del Seguro">Espera Aprobación del Seguro</option>
              <option value="Cirujano no disponible">Cirujano no disponible</option>
              <option value="Paciente no disponible">Paciente no disponible</option>
              <option value="Documentación Incompleta">Documentación Incompleta</option>
            </select>
            <br>

            <!-- FECHA REGISTRO-->
            <label for="appointment-date"><b>Fecha de Registro</b></label>
            <input type="date" id="appointment-date" name="DateAdded" class="form-control" required/>
            <br>

            <!-- PRIORIDAD -->
            <label for="PriorityLevel"><b>Prioridad</b></label>
            <select class="form-select" name="PriorityLevel" required aria-label="select example">
              <option value="">Seleccione la Prioridad</option>
              <option value="Low">Baja</option>
              <option value="Medium">Media</option>
              <option value="High">Alta</option>
            </select>
            <br>

            <!-- ENVIAR -->
            <button type="submit" class="btn btn-outline-primary col-md-12">Enviar</button>
          </div>    

          <div class="col-md-9">
            <br>
            <table id="dataTable" border="1" class="table">
              <thead>
                <tr>
                  <th>Paciente</th>
                  <th>Razón de Espera</th>
                  <th>Fecha de Registro</th>
                  <th>Prioridad</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data will be dynamically inserted here -->
              </tbody>
            </table>
          </div>

          
        </form>
      </div>
    </section>

    <script src="/dist/index.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
          <script>
            document
              .getElementById("dataForm")
              .addEventListener("submit", async (event) => {
                event.preventDefault();

                const formData = new FormData(event.target);
                const data = Object.fromEntries(formData.entries());

                // Insert data via POST request
                const response = await fetch("/api/waitinglist", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(data),
                });

                if (response.ok) {
                  event.target.reset(); // Clear the form after successful submission
                  loadTableData(); // Load the updated table data
                }
              });

            async function loadTableData() {
              const response = await fetch("/api/waitinglist");
              const data = await response.json();

              const tableBody = document.querySelector("#dataTable tbody");
              tableBody.innerHTML = ""; // Clear existing rows

              data.forEach((row) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${row.PatientName}</td><td>${row.ReasonForWaiting}</td><td>${row.DateAdded}</td><td>${row.PriorityLevel}</td>`;
                tableBody.appendChild(tr);
              });
            }
            loadTableData();
              window.onload = loadTableData;
      </script>
  </body>
</html>
